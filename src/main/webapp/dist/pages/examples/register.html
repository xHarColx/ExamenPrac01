<!doctype html>
<html lang="en">
    <!--begin::Head-->
    <head>



        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>AdminLTE 4 | Register Page</title>
        <!--begin::Primary Meta Tags-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="title" content="AdminLTE 4 | Register Page" />
        <meta name="author" content="ColorlibHQ" />
        <meta
            name="description"
            content="AdminLTE is a Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS."
            />
        <meta
            name="keywords"
            content="bootstrap 5, bootstrap, bootstrap 5 admin dashboard, bootstrap 5 dashboard, bootstrap 5 charts, bootstrap 5 calendar, bootstrap 5 datepicker, bootstrap 5 tables, bootstrap 5 datatable, vanilla js datatable, colorlibhq, colorlibhq dashboard, colorlibhq admin dashboard"
            />
        <!--end::Primary Meta Tags-->
        <!--begin::Fonts-->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
            integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q="
            crossorigin="anonymous"
            />
        <!--end::Fonts-->
        <!--begin::Third Party Plugin(OverlayScrollbars)-->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/styles/overlayscrollbars.min.css"
            integrity="sha256-tZHrRjVqNSRyWg2wbppGnT833E/Ys0DHWGwT04GiqQg="
            crossorigin="anonymous"
            />
        <!--end::Third Party Plugin(OverlayScrollbars)-->
        <!--begin::Third Party Plugin(Bootstrap Icons)-->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
            integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI="
            crossorigin="anonymous"
            />
        <!--end::Third Party Plugin(Bootstrap Icons)-->
        <!--begin::Required Plugin(AdminLTE)-->
        <link rel="stylesheet" href="../../../dist/css/adminlte.css" />
        <!--end::Required Plugin(AdminLTE)-->
        <!-- Otros elementos head... -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="../../../CryptoJS v3.1.2/rollups/aes.js" type="text/javascript"></script>
        <script src="../../../CryptoJS v3.1.2/components/mode-ecb-min.js" type="text/javascript"></script>

    </head>
    <!--end::Head-->
    <!--begin::Body-->
    <body class="register-page bg-body-secondary">
        <div class="register-box">
            <div class="register-logo">
                <a href="../index2.html"><b>Admin</b>LTE</a>
            </div>
            <!-- /.register-logo -->
            <div class="card">
                <div class="card-body register-card-body">
                    <p class="register-box-msg">Registro de nuevo cliente</p>
                    <form id="registroForm" method="post">
                        <!-- DNI -->
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="ndniClie" placeholder="DNI" maxlength="8" required />
                            <div class="input-group-text"><span class="bi bi-card-text"></span></div>
                        </div>

                        <!-- Apellido Paterno -->
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="appaClie" placeholder="Apellido Paterno" maxlength="50" required />
                            <div class="input-group-text"><span class="bi bi-person-vcard"></span></div>
                        </div>

                        <!-- Apellido Materno -->
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="apmaClie" placeholder="Apellido Materno" maxlength="50" required />
                            <div class="input-group-text"><span class="bi bi-person-vcard"></span></div>
                        </div>

                        <!-- Nombres -->
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="nombClie" placeholder="Nombres" maxlength="50" required />
                            <div class="input-group-text"><span class="bi bi-person"></span></div>
                        </div>

                        <!-- Fecha de Nacimiento -->
                        <div class="input-group mb-3">
                            <input type="date" class="form-control" id="fechNaciClie" required />
                            <div class="input-group-text"><span class="bi bi-calendar"></span></div>
                        </div>

                        <!-- Email (Login) -->
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="logiClie" placeholder="username" maxlength="100" required />
                            <div class="input-group-text"><span class="bi bi-envelope"></span></div>
                        </div>

                        <!-- Contraseña -->
                        <div class="input-group mb-3">
                            <input type="password" class="form-control" id="passClie" placeholder="Contraseña" required />
                            <div class="input-group-text"><span class="bi bi-lock-fill"></span></div>
                        </div>



                        <!-- Términos y condiciones -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="termsCheck" required />
                                    <label class="form-check-label" for="termsCheck">
                                        Acepto los <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">términos y condiciones</a>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Botón de Registro -->
                        <div class="row">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary w-100">Registrarse</button>
                            </div>
                        </div>
                    </form>

                    <!-- Enlace para login -->
                    <p class="mt-3 mb-0 text-center">
                        ¿Ya tienes una cuenta? <a href="http://localhost:8080/ExamenPrac01/index.html">Inicia sesión</a>
                    </p>
                </div>
            </div>

            <!-- Modal de Términos y Condiciones -->
            <div class="modal fade" id="termsModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Términos y Condiciones</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Contenido de los términos aquí -->
                            <p>Texto con los términos y condiciones del servicio...</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                const clave = "1234567890123456";
                function cifrar(message, key) {
                    let keyUtf8 = CryptoJS.enc.Utf8.parse(key);
                    let encrypted = CryptoJS.AES.encrypt(message, keyUtf8, {
                        mode: CryptoJS.mode.ECB,
                        padding: CryptoJS.pad.Pkcs7
                    });
                    return encrypted.toString(); // Base64
                }

                function descifrar(ciphertext, key) {
                    try {
                        let keyUtf8 = CryptoJS.enc.Utf8.parse(key);
                        let decrypted = CryptoJS.AES.decrypt(ciphertext, keyUtf8, {
                            mode: CryptoJS.mode.ECB,
                            padding: CryptoJS.pad.Pkcs7
                        });
                        return decrypted.toString(CryptoJS.enc.Utf8); // Retorna string plano
                    } catch (e) {
                        return "[Mensaje no descifrado]";
                    }
                }
                function setCookie(nombre, valor, dias) {
                    const fecha = new Date();
                    fecha.setTime(fecha.getTime() + (dias * 24 * 60 * 60 * 1000));
                    const expira = "expires=" + fecha.toUTCString();
                    document.cookie = nombre + "=" + valor + ";" + expira + ";path=/";
                }


                document.getElementById('registroForm').addEventListener('submit', async function (e) {
                    e.preventDefault();
                    const pass = document.getElementById('passClie').value;
                    const passCifrada = cifrar(pass, clave);

                    // Obtener valores sin jQuery
                    const formData = {
                        ndniClie: document.getElementById('ndniClie').value,
                        appaClie: document.getElementById('appaClie').value,
                        apmaClie: document.getElementById('apmaClie').value,
                        nombClie: document.getElementById('nombClie').value,
                        fechaNaci: document.getElementById('fechNaciClie').value,
                        logiClie: document.getElementById('logiClie').value,
                        passsClie: passCifrada
                    };

                    console.log(formData);

                    try {
                        const response = await fetch('http://localhost:8080/ExamenPrac01/crear-cliente', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(formData)
                        });

                        const data = await response.json();
                        console.log(data);
                        if (!response.ok) {
                            throw new Error(data.mensaje || 'Error en el servidor');
                        }

                        if (data.resultado === 'ok') {
                            setCookie("token", data.token, 7);
                            alert('Cliente agregado exitosamente');
                            window.location.href = 'http://localhost:8080/ExamenPrac01/index.html';
                        } else {
                            alert('Error al agregar el Cliente: ' + data.mensaje);
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al enviar la solicitud: ' + error.message);
                    }
                });</script>
        </div>
        <!-- /.register-box -->
        <!--begin::Third Party Plugin(OverlayScrollbars)-->
        <script
            src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js"
            integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ="
            crossorigin="anonymous"
        ></script>
        <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>
        <!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
            integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
            crossorigin="anonymous"
        ></script>
        <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
        <script src="../../../dist/js/adminlte.js"></script>
        <!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->
        <script>
                const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
                const Default = {
                    scrollbarTheme: 'os-theme-light',
                    scrollbarAutoHide: 'leave',
                    scrollbarClickScroll: true,
                };
                document.addEventListener('DOMContentLoaded', function () {
                    const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
                    if (sidebarWrapper && typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== 'undefined') {
                        OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
                            scrollbars: {
                                theme: Default.scrollbarTheme,
                                autoHide: Default.scrollbarAutoHide,
                                clickScroll: Default.scrollbarClickScroll,
                            },
                        });
                    }
                });
        </script>
        <!--end::OverlayScrollbars Configure-->
        <!--end::Script-->
    </body>


    <!--end::Body-->
</html>
